---
title: "Restructure"
author: "PRIYAM"
date: "2023-01-03"
output:
  word_document: default
  html_document: default
---


```{r}
library(tidyverse)
library(readxl)
library(stargazer)
library(magrittr)
library(haven)
library(plm)
library(ggplot2)
library(dplyr)
library(VGAM)
library(censReg)
library(writexl)
library(Rserve)
library(pastecs)
library(panelr)
```



```{r}

df <- read_excel("C:/Users/91910/Desktop/Me MaRio/Papers/Subcontracting & Innovation/Data 2/Main Data Panel.xlsx")

```

```{r}
#Changing the vaRiable names 
df$NIC2 <- substr(df$`NIC code`, 1, 2)


names(df)[names(df) == "Year2"] <- "Year"
names(df)[names(df) == "Year13"] <- "Year"
names(df)[names(df) == "Year24"] <- "Year"
names(df)[names(df) == "Year35"] <- "Year"
names(df)[names(df) == "Year46"] <- "Year"
names(df)[names(df) == "Year57"] <- "Year"
names(df)[names(df) == "Year68"] <- "Year"
names(df)[names(df) == "Year79"] <- "Year"
names(df)[names(df) == "Year90"] <- "Year"
names(df)[names(df) == "Year101"] <- "Year"
names(df)[names(df) == "Year112"] <- "Year"


names(df)[names(df) == "Job-work income"] <- "SUB"
names(df)[names(df) == "Job-work income3"] <- "SUB"
names(df)[names(df) == "Job-work income14"] <- "SUB"
names(df)[names(df) == "Job-work income25"] <- "SUB"
names(df)[names(df) == "Job-work income36"] <- "SUB"
names(df)[names(df) == "Job-work income47"] <- "SUB"
names(df)[names(df) == "Job-work income58"] <- "SUB"
names(df)[names(df) == "Job-work income69"] <- "SUB"
names(df)[names(df) == "Job-work income80"] <- "SUB"
names(df)[names(df) == "Job-work income91"] <- "SUB"
names(df)[names(df) == "Job-work income102"] <- "SUB"
names(df)[names(df) == "Job-work income113"] <- "SUB"

names(df)[names(df) == "Profit after tax"] <- "PAT"
names(df)[names(df) == "Profit after tax4"] <- "PAT"
names(df)[names(df) == "Profit after tax15"] <- "PAT"
names(df)[names(df) == "Profit after tax26"] <- "PAT"
names(df)[names(df) == "Profit after tax37"] <- "PAT"
names(df)[names(df) == "Profit after tax48"] <- "PAT"
names(df)[names(df) == "Profit after tax59"] <- "PAT"
names(df)[names(df) == "Profit after tax70"] <- "PAT"
names(df)[names(df) == "Profit after tax81"] <- "PAT"
names(df)[names(df) == "Profit after tax92"] <- "PAT"
names(df)[names(df) == "Profit after tax103"] <- "PAT"
names(df)[names(df) == "Profit after tax114"] <- "PAT"

names(df)[names(df) == "Research & development expenses - current account"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account5"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account16"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account27"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account38"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account49"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account60"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account71"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account82"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account93"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account104"] <- "R&D"
names(df)[names(df) == "Research & development expenses - current account115"] <- "R&D"

names(df)[names(df) == "Net sales6"] <- "Net sales"
names(df)[names(df) == "Net sales17"] <- "Net sales"
names(df)[names(df) == "Net sales28"] <- "Net sales"
names(df)[names(df) == "Net sales39"] <- "Net sales"
names(df)[names(df) == "Net sales50"] <- "Net sales"
names(df)[names(df) == "Net sales61"] <- "Net sales"
names(df)[names(df) == "Net sales72"] <- "Net sales"
names(df)[names(df) == "Net sales83"] <- "Net sales"
names(df)[names(df) == "Net sales94"] <- "Net sales"
names(df)[names(df) == "Net sales105"] <- "Net sales"
names(df)[names(df) == "Net sales116"] <- "Net sales"

names(df)[names(df) == "Net plant and machinery"] <- "NPM"
names(df)[names(df) == "Net plant and machinery7"] <- "NPM"
names(df)[names(df) == "Net plant and machinery18"] <- "NPM"
names(df)[names(df) == "Net plant and machinery29"] <- "NPM"
names(df)[names(df) == "Net plant and machinery40"] <- "NPM"
names(df)[names(df) == "Net plant and machinery51"] <- "NPM"
names(df)[names(df) == "Net plant and machinery62"] <- "NPM"
names(df)[names(df) == "Net plant and machinery73"] <- "NPM"
names(df)[names(df) == "Net plant and machinery84"] <- "NPM"
names(df)[names(df) == "Net plant and machinery95"] <- "NPM"
names(df)[names(df) == "Net plant and machinery106"] <- "NPM"
names(df)[names(df) == "Net plant and machinery117"] <- "NPM"

names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid8"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid19"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid30"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid41"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid52"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid63"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid74"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid85"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid96"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid107"] <- "Sal&Wag"
names(df)[names(df) == "Salaries, wages, bonus, ex gratia pf & gratuities paid118"] <- "Sal&Wag"

names(df)[names(df) == "Technical know-how fees and technical service fees"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees9"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees20"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees31"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees42"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees53"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees64"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees75"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees86"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees97"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees108"] <- "TK"
names(df)[names(df) == "Technical know-how fees and technical service fees119"] <- "TK"









names(df)[names(df) == "Company Name"] <- "CC"
names(df)[names(df) == "NIC code"] <- "NIC"



```

```{r}
#Have made a new panel data using just the companies as the index 

#The lines of code given below are for making the data and making the data available as csv format. 

E3<-pdata.frame(df, index=("CC"), drop.index=TRUE, row.names=TRUE)
 write.csv(E3, file = "DATA.csv")

 
 
#This is the data that converts the data into longitudinal data structure that we are looking for. 
E3.2<-read.csv("DATA.csv")
str(E3.2)

pnl<- long_panel(E3.2, prefix = ".", begin = 1, end = 9, id = "X", as_panel_data = T)
```


```{r}
pnl$Si = pnl$SUB / pnl$Net.sales
pnl$Ri = pnl$R.D / pnl$Net.sales
pnl$Pi = pnl$PAT / pnl$Net.sales
pnl$Ti = pnl$TK / pnl$Net.sales
pnl$NPMi = pnl$NPM / pnl$Net.sales
#write.csv(pnl, file = "panel.csv")


```



```{r}
#NIC Sets


pnl_10<-subset(pnl, substr(pnl$NIC, 1, 2) == 10)
pnl_11<-subset(pnl, substr(pnl$NIC, 1, 2) == 11)
pnl_12<-subset(pnl, substr(pnl$NIC, 1, 2) == 12)
pnl_13<-subset(pnl, substr(pnl$NIC, 1, 2) == 13)
pnl_14<-subset(pnl, substr(pnl$NIC, 1, 2) == 14)
pnl_15<-subset(pnl, substr(pnl$NIC, 1, 2) == 15)
pnl_16<-subset(pnl, substr(pnl$NIC, 1, 2) == 16)
pnl_17<-subset(pnl, substr(pnl$NIC, 1, 2) == 17)
pnl_18<-subset(pnl, substr(pnl$NIC, 1, 2) == 18)
pnl_19<-subset(pnl, substr(pnl$NIC, 1, 2) == 19)
pnl_20<-subset(pnl, substr(pnl$NIC, 1, 2) == 20)
pnl_21<-subset(pnl, substr(pnl$NIC, 1, 2) == 21)
pnl_22<-subset(pnl, substr(pnl$NIC, 1, 2) == 22)
pnl_23<-subset(pnl, substr(pnl$NIC, 1, 2) == 23)
pnl_24<-subset(pnl, substr(pnl$NIC, 1, 2) == 24)
pnl_25<-subset(pnl, substr(pnl$NIC, 1, 2) == 25)
pnl_26<-subset(pnl, substr(pnl$NIC, 1, 2) == 26)
pnl_27<-subset(pnl, substr(pnl$NIC, 1, 2) == 27)
pnl_28<-subset(pnl, substr(pnl$NIC, 1, 2) == 28)
pnl_29<-subset(pnl, substr(pnl$NIC, 1, 2) == 29)
pnl_30<-subset(pnl, substr(pnl$NIC, 1, 2) == 30)
pnl_31<-subset(pnl, substr(pnl$NIC, 1, 2) == 31)
pnl_32<-subset(pnl, substr(pnl$NIC, 1, 2) == 32)
pnl_33<-subset(pnl, substr(pnl$NIC, 1, 2) == 33)



```

```{r}
#Running the RegresSion Models with the new data structure. 

###FE MODEL

grun.fe <- plm(Ri ~ Si + Pi  + Net.sales, data = pnl, model = "within")
summary(grun.fe) 
nobs(grun.fe)

###RANDOM MODEL
grun.re2 <- plm(Ri ~ Si + Pi +  Net.sales, data = pnl, model = "random")
summary(grun.re2)
nobs(grun.re2)


###Hausman test
## If p-value is < 0.05 then use fixed effects
phtest(grun.fe, grun.re2)
```

```{r}
panelResult <- censReg( Ri ~ Si + Pi + Net.sales, data = pnl)

summary (panelResult)


```


```{r}
###Without CensReg
Reg_10a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_10)
summary(Reg_10a)

Reg_11a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_11)
summary(Reg_11a)

Reg_12a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_12)
summary(Reg_12a)

Reg_13a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_13)
summary(Reg_13a)

Reg_14a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_14)
summary(Reg_14a)

#Reg_15a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_15, model  = "within")
#summary(Reg_15a)

Reg_16a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_16)
summary(Reg_16a)

Reg_17a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_17)
summary(Reg_17a)

Reg_18a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_18)
summary(Reg_18a)

#Reg_19a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_19)
#summary(Reg_19a)

Reg_20a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_20)
summary(Reg_20a)

Reg_21a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_21)
summary(Reg_21a)

Reg_22a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_22)
summary(Reg_22a)

Reg_23a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_23)
summary(Reg_23a)

Reg_24a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_24)
summary(Reg_24a)

Reg_25a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_25)
summary(Reg_25a)

Reg_26a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_26)
summary(Reg_26a)

Reg_27a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_27)
summary(Reg_27a)

Reg_28a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_28)
summary(Reg_28a)

Reg_29a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_29)
summary(Reg_29a)

Reg_30a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_30)
summary(Reg_30a)

#Reg_31a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_31)
#summary(Reg_31a)

Reg_32a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_32)
summary(Reg_32a)

#Reg_33a<- plm(Ri ~ Si + Pi + Net.sales, data = pnl_33)
#summary(Reg_33a)
```




```{r}
###With CensReg
Reg_10b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_10)
summary(Reg_10b)

Reg_11b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_11)
summary(Reg_11b)

#Reg_12b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_12) {NO Cens term}
#summary(Reg_12b)

Reg_13b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_13)
summary(Reg_13b)

Reg_14b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_14)
summary(Reg_14b)

#Reg_15b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_15) {NO Cens term}
#summary(Reg_15b)


#Reg_16b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_16) {NO Cens term}
#summary(Reg_16b)

#Reg_17b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_17) {NO Cens term}
#summary(Reg_17b)

#Reg_18b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_18) {NO Cens term}
#summary(Reg_18b)

Reg_19b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_19)
summary(Reg_19b)

Reg_20b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_20)
summary(Reg_20b)

Reg_21b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_21)
summary(Reg_21b)

Reg_22b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_22)
summary(Reg_22b)

Reg_23b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_23)
summary(Reg_23b)

Reg_24b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_24)
summary(Reg_24b)

Reg_25b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_25)
summary(Reg_25b)

Reg_26b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_26)
summary(Reg_26b)

Reg_27b<- censReg(Ri ~ Si + Pi + Net.sales, data = pnl_27)
summary(Reg_27b)
```




